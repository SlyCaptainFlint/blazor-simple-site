<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <title>Olga Zinoveva</title>
    <base href="/" />
    <link href="https://fonts.googleapis.com/css?family=Montserrat|Raleway|Abel|Advent+Pro|Cairo|Economica|Josefin+Slab|Overpass|Poiret+One|Quicksand|Rajdhani&display=swap" rel="stylesheet"> 
    <link href="css/site.css" rel="stylesheet" />
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
</head>

<body>


    <app>
        <div class="default-background">
            <div class="ui-loader"></div>
        </div>        
    </app>

    <div id="blazor-error-ui"class="notification is-warning">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
    </div>
    
    <script src="_framework/blazor.webassembly.js"></script>
    <script type="text/javascript">
    
        let preloadVideo = function(videoPath) {
            return new Promise((resolve, reject) => {
                let req = new XMLHttpRequest();
                req.open('GET', videoPath, true);
                req.responseType = 'blob';

                req.onload = function() {
                    // Onload is triggered even on 404
                    // so we need to check the status code
                    if (this.status === 200) {
                        let videoBlob = this.response;
                        let vid = URL.createObjectURL(videoBlob); 
                        
                        resolve(vid);
                    }
                }

                req.onerror = function() {
                    console.log("error loading video");
                    reject();
                }

                req.send();
            });
        }

        // Detect first touch and assume that the user will primarily use touch on the site.
        // This will allow customizing styles in the gallery accordingly.
        document.addEventListener('touchstart', (event) => {
            document.body.classList.add('touch-styles');
        });

        window.turnOnBodyScrolling = function() {
            const scrollY = document.body.style.top;
            document.body.style.position = '';
            document.body.style.top = '';
            window.scrollTo(0, parseInt(scrollY || '0') * -1);
        };

        window.turnOffBodyScrolling = function() {
            document.body.style.top = `-${window.scrollY}px`;
            document.body.style.position = 'fixed';            
        };
        
        window.getMainContainerDimensions = function() {
            let element = document.getElementById("MainBodyContainer");
            return {
                width: element.clientWidth,
                height: element.clientHeight
            };
        };

        window.playBackgroundVideos = async function(videoIntroId, videoLoopingId, fullSize = true) {
            let preloadIntroPromise;
            let preloadLoopPromise;

            if(fullSize){
                preloadIntroPromise = preloadVideo('intro.mp4');
                preloadLoopPromise = preloadVideo('loop.mp4');
            }
            else{
                preloadIntroPromise = preloadVideo('intro_mobile.mp4');
                preloadLoopPromise = preloadVideo('loop_mobile.mp4');
            }

            let playVideos = async () => {
                let videoIntro = document.getElementById(videoIntroId);
                let videoLooping = document.getElementById(videoLoopingId);

                videoIntro.addEventListener('ended', async (event) => {
                    videoIntro.classList.add('hidden');
                });
                videoIntro.addEventListener('error', async (event) => {
                    videoIntro.classList.add('hidden');
                });

                let loadedIntro = await preloadIntroPromise;
                videoIntro.src = loadedIntro;
                videoIntro.muted = 'muted';
                let introVideoPlayPromise =  videoIntro.play();

                let loadedLoop = await preloadLoopPromise;                    
                videoLooping.src = loadedLoop;
                videoLooping.muted = 'muted';
                videoLooping.classList.remove('hidden');

                let loopVideoPlayPromise = videoLooping.play();
                await Promise.all([introVideoPlayPromise, loopVideoPlayPromise]);
            };

            try {
                await playVideos();
                await DotNet.invokeMethodAsync('PersonalSite', 'ShowNavigationMenu');
            }
            catch {
                let startButton = document.getElementById('startButtonContainer');
                startButton.classList.remove('hidden');

                document.addEventListener('touchend', async (event) => {
                    event.preventDefault();
                    startButton.classList.add('hidden');
                    await DotNet.invokeMethodAsync('PersonalSite', 'ShowNavigationMenu');
                    try {
                        await playVideos();
                    }
                    catch {
                        let fallbackBackground = document.getElementById('fallbackBackground');
                        fallbackBackground.classList.remove('hidden');
                    }
                }, {once : true});
            }
        };

        window.playVideoIfNotStarted = async function(videoId) {
            let video = document.getElementById(videoId);
            video.classList.remove('hidden');
            video.muted = 'muted';
            video.addEventListener('canplaythrough', (event) => {
                video.play();
            });            
        }
    </script>
</body>

</html>
